---
title: "Project 4"
author: "CyberBoolin"
date: "2022-09-28"
bibliography: BIOL3140.bib
output: html_document

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r,include=FALSE}
library(tidyverse) #always
library(ape) #for evo analysis
library(nlme) #ditto
library(MuMIn) #for AIC
library(geiger) #for eco analysis
library(knitr) #for knitting options
```

## Introduction
Include a brief background to the anole project (why are we studying this anyway?), what the main questions is, and how this question will be answered.

</center>
![A cute ***Anolis*** lizard](https://live.staticflickr.com/3061/2494132461_1c7529585f_b.jpg)
</center>

## Methods
Briefly outline the specifics of how the question will be answered.

## Results
Briefly summarize the results.
```{r, "load the data", include=FALSE}
anole <- read_csv("anole.dat.csv")
anole.eco <- read_csv("anole.eco.csv")
anole.tree <- read.tree("anole.tre")
```
```{r, "join, filter, mutate to log", include=FALSE}
anole2 <- anole%>%
left_join(anole.eco)%>%
  filter(!Ecomorph%in%c("U","CH"))%>%
  na.omit()

anole.log <- anole2%>%
  mutate_at(c("SVL", "HTotal","PH","ArbPD"),log)
```
```{r, "PGLS models", include=FALSE}
### phylogenetic GLS models

#PGLS under BM, no ecomorph
pgls.BM1 <- gls(HTotal ~SVL, correlation = corBrownian(1,phy = anole.tree,form=~Species),data = anole.log, method = "ML")

#PGLS under BM, w ecomorph
pgls.BM2 <- gls(HTotal ~SVL * Ecomorph2, correlation = corBrownian(1,phy = anole.tree,form=~Species),data = anole.log, method = "ML")

#PGLS under OU, no ecomorph
pgls.OU1 <- gls(HTotal ~SVL, correlation = corMartins(0,phy = anole.tree,form=~Species),data = anole.log, method = "ML")

#PGLS under OU, w, ecomorph
pgls.OU2 <- gls(HTotal ~SVL * Ecomorph2, correlation = corMartins(0,phy = anole.tree,form=~Species),data = anole.log, method = "ML")
```
```{r, "AIC", include=FALSE}
#AIC operations
anole.phylo.aic <- AICc(pgls.BM1,pgls.BM2,pgls.OU1,pgls.OU2)
anole.phylow.aicw <- aicw(anole.phylo.aic$AICc)
```
```{r, "add residuals", include=FALSE}
#add phylo-corrected residuals
anole.log <- anole.log%>%
  mutate(phylo.res=residuals(pgls.BM2))
```
```{r,"plot residuals", fig.cap="Boxplot of phylogenetically corrected hindlimb residuals versus anole ecomorph", echo=FALSE}
#plot residuals
p.eco.phylo <- anole.log%>%
ggplot(aes(x=Ecomorph2,y=phylo.res)) +geom_boxplot() +stat_summary(fun=mean, geom="point", size=3)

print(p.eco.phylo)

```

## Discussion
Briefly discuss the importance of the results (i.e., how they relate to the main question).

## Author Contributions
Briefly state what the contributions of each team member to the project.

## References
Hagey, Travis J, Scott Harte, Mathew Vickers, Luke J Harmon, and Lin Schwarzkopf. 2017.
“There’s More Than One Way to Climb a Tree: Limb Length and Microhabitat Use in Lizards with Toe Pads.” PloS One 12 (9): e0184641.

anole.phylo.aic <- AICc(pgls.BM1,pgls.BM2,pgls.OU1,pgls.OU2)
anole.phylow.aicw <- aicw(anole.phylo.aic$AICc)

n.spec <- anole.log%>%
  group_by(Ecomorph2)%>%
  summarise(n.species=n())

n.spec%>%
  kable(caption = "AIC Values")


An altered “AIC” chunk that produces a table of AIC values with kable. Be sure to include a descriptive caption

Another chunk of code, inserted before the “plot residuals” chunk, that produces a figure of a regression plot of log-transformed HTotal vs SVL with points colored by Ecomorph2. Be sure to include a descriptive caption here, too.
A citation to the Hagey et al. (2017) paper in the introduction (include in the References section, too)
A citation in the methods sections that identifies the source of the phylogenetic tree used in PGLS analysis (include in the References section as well).

