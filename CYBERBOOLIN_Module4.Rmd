---
title: "Project 4"
author: "CyberBoolin"
date: "2022-09-28"
bibliography: BIOL3140.bib
output: html_document

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r,include=FALSE}
library(tidyverse) #always
library(ape) #for evo analysis
library(nlme) #ditto
library(MuMIn) #for AIC
library(geiger) #for eco analysis
library(knitr) #for knitting options
```

## Introduction

The main goal of this project is to look at the morphological and allometric difference between the different ecomorphs within the genus *Anolis*. The term ecomorph was created by evolutionary biologist and herpetologist Ernest Edward Williams, using the genus *Anolis* as his model. 'Ecomorph' means a group of species with a similar ecological niche and behavior within said niche. For the *Anolis* genus, we will be assessing the relationship between hind limb length and size, based on a recent study by @hagey2017there in the context of their niche using a variety of visualization methods.


</center>
![A cute ***Anolis*** lizard](https://live.staticflickr.com/3061/2494132461_1c7529585f_b.jpg)
</center>

## Methods
First, an anole.log data tibble was established. Following this, two simple linear models that assesed the effect of perch diameter and height (by including these as covariates in the models) were constructed using the log trasformed data. Then explore how both perch diameter and height effect the hindlimb-SVL relationship by plotting the residuals of the simple linear models against these discrete factors. A phylogenetic least squares model of the hindlimb-SVL relationships was constructed under a BM model of trait evolution, including the unique combinations of the two covariates. Then, assess the fit of each of the three models using AICc and AICw and comment on whether one or both of the covariates is a significant predictor of hindlimb length, in a phylogenetic context. Finally, produce a plot that visualizes the effect of the covariates and factors on the hindlimb residuals of the best fitting PGLS model.

## Results
Briefly summarize the results.
```{r, "load the data", include=FALSE}
anole <- read_csv("anole.dat.csv")
anole.eco <- read_csv("anole.eco.csv")
anole.tree <- read.tree("anole.tre")
```

```{r, "join, filter, mutate to log", include=FALSE}
anole2 <- anole%>%
left_join(anole.eco)%>%
  filter(!Ecomorph%in%c("U","CH"))%>%
  na.omit()

anole.log <- anole2%>%
  mutate_at(c("SVL", "HTotal","PH","ArbPD"),log)
```

```{r, "PGLS models", include=FALSE}
### phylogenetic GLS models

#PGLS under BM, no ecomorph
pgls.BM1 <- gls(HTotal ~SVL, correlation = corBrownian(1,phy = anole.tree,form=~Species),data = anole.log, method = "ML")

#PGLS under BM, w ecomorph
pgls.BM2 <- gls(HTotal ~SVL * Ecomorph2, correlation = corBrownian(1,phy = anole.tree,form=~Species),data = anole.log, method = "ML")

#PGLS under OU, no ecomorph
pgls.OU1 <- gls(HTotal ~SVL, correlation = corMartins(0,phy = anole.tree,form=~Species),data = anole.log, method = "ML")

#PGLS under OU, w, ecomorph
pgls.OU2 <- gls(HTotal ~SVL * Ecomorph2, correlation = corMartins(0,phy = anole.tree,form=~Species),data = anole.log, method = "ML")
```

```{r, "AIC", echo=FALSE}
#AIC operations
anole.phylo.aic <- AICc(pgls.BM1,pgls.BM2,pgls.OU1,pgls.OU2)
anole.phylow.aicw <- aicw(anole.phylo.aic$AICc)

#Kable
anole.phylo.aic%>%
  kable(caption="AIC of BM and BM and OU PGLS Models Considering Ecomorph of *Anolis*")
anole.phylow.aicw%>%
  mutate(models=c("pgls.BM1","pgls.BM2","pgls.OU1","pgls.OU2"))%>%
  kable(caption="AIC of BM and OU PGLS Models Considering Ecomorph of *Anolis* ")
```

```{r, "add residuals", include=FALSE}
#add phylo-corrected residuals
anole.log <- anole.log%>%
  mutate(phylo.res=residuals(pgls.BM2))
```

```{r, fig.cap="Regression Plot of Log-transformed HTotal vs. SVL by Ecomorphs", echo=FALSE}
#Regression Plot 
anole.log%>%
  ggplot(aes(HTotal,SVL,col=Ecomorph2))+geom_point()+geom_smooth(method="lm")
```

```{r,"plot residuals", fig.cap="Boxplot of phylogenetically corrected hindlimb residuals versus anole ecomorph", echo=FALSE}
#plot residuals
p.eco.phylo <- anole.log%>%
ggplot(aes(x=Ecomorph2,y=phylo.res)) +geom_boxplot() +stat_summary(fun=mean, geom="point", size=3)

print(p.eco.phylo)

```



## Discussion
Briefly discuss the importance of the results (i.e., how they relate to the main question).

## Author Contributions
Briefly state what the contributions of each team member to the project.

## References
Hagey, Travis J, Scott Harte, Mathew Vickers, Luke J Harmon, and Lin Schwarzkopf. 2017.
“There’s More Than One Way to Climb a Tree: Limb Length and Microhabitat Use in Lizards with Toe Pads.” PloS One 12 (9): e0184641.



An altered “AIC” chunk that produces a table of AIC values with kable. Be sure to include a descriptive caption **GOTEEM B-)**

Another chunk of code, inserted before the “plot residuals” chunk, that produces a figure of a regression plot of log-transformed HTotal vs SVL with points colored by Ecomorph2. Be sure to include a descriptive caption here, too. **DONE**

A citation to the Hagey et al. (2017) paper in the introduction (include in the References section, too) **CRUSHED IT**

A citation in the methods sections that identifies the source of the phylogenetic tree used in PGLS analysis (include in the References section as well).

